(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[122],{601:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>o});var t=a(5155),r=a(2115),l=a(1010),n=a(5917),d=a(5229);function o(){let[e,s]=(0,r.useState)(null),[a,o]=(0,r.useState)("profile"),[i,c]=(0,r.useState)(!1),[m,u]=(0,r.useState)(""),[p,x]=(0,r.useState)(""),[h,b]=(0,r.useState)(""),[f,w]=(0,r.useState)(""),[j,g]=(0,r.useState)(""),[y,N]=(0,r.useState)(""),[v,S]=(0,r.useState)({}),[C,k]=(0,r.useState)(""),[P,E]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/admin/me");if(!e.ok)throw Error("Failed to fetch admin data");let a=await e.json();s(a),u(a.name),x(a.email)}catch(e){console.error(e)}})()},[]),(0,r.useEffect)(()=>{if(!C)return;let e=setTimeout(()=>k(""),4e3);return()=>clearTimeout(e)},[C]);let T=async e=>{if(e.preventDefault(),S({}),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p))return S({email:"Enter a valid email."});if(!h)return S({password:"Enter current password."});try{E(!0);let e=await fetch("/api/admin/profile",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:m,email:p,currentPassword:h})}),a=await e.json();if(!e.ok)return S({password:a.message||"Failed to update profile."});s({name:m,email:p}),c(!1),b(""),k("Profile updated successfully!")}catch(e){S({password:"Server error. Please try again later."})}finally{E(!1)}},_=async e=>{if(e.preventDefault(),S({}),!f)return S({password:"Enter current password."});if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(j))return S({password:"Password must be 8+ chars with uppercase, lowercase, and number."});if(j!==y)return S({password:"Passwords do not match."});try{E(!0);let e=await fetch("/api/admin/password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:f,newPassword:j})}),s=await e.json();if(!e.ok)return S({password:s.message||"Failed to update password."});k("Password updated successfully!"),w(""),g(""),N("")}catch(e){S({password:"Server error. Please try again later."})}finally{E(!1)}};return e?(0,t.jsxs)("div",{className:"p-6 max-w-2xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Settings"}),(0,t.jsxs)("div",{className:"flex border-b mb-6",children:[(0,t.jsx)("button",{className:"px-4 py-2 -mb-px font-semibold ".concat("profile"===a?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-blue-600"),onClick:()=>o("profile"),children:"Profile"}),(0,t.jsx)("button",{className:"px-4 py-2 -mb-px font-semibold ".concat("password"===a?"border-b-2 border-green-600 text-green-600":"text-gray-600 hover:text-green-600"),onClick:()=>o("password"),children:"Password"})]}),"profile"===a&&(0,t.jsx)("div",{className:"space-y-6",children:i?(0,t.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block mb-1 font-medium",children:"Name"}),(0,t.jsx)("input",{type:"text",value:m,onChange:e=>u(e.target.value),className:"w-full border p-2 rounded"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block mb-1 font-medium",children:"Email"}),(0,t.jsx)("input",{type:"email",value:p,onChange:e=>x(e.target.value),className:"w-full border p-2 rounded"}),v.email&&(0,t.jsx)("p",{className:"text-red-500 text-sm",children:v.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block mb-1 font-medium",children:"Current Password"}),(0,t.jsx)("input",{type:"password",value:h,onChange:e=>b(e.target.value),className:"w-full border p-2 rounded",placeholder:"Enter current password to confirm changes"}),v.password&&(0,t.jsx)("p",{className:"text-red-500 text-sm",children:v.password})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{type:"submit",disabled:P,className:"bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-1 ".concat(P?"opacity-50 cursor-not-allowed":"hover:bg-blue-700"),children:P?"Saving...":(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.A,{size:16})," Save"]})}),(0,t.jsxs)("button",{type:"button",disabled:P,className:"bg-gray-400 text-white px-4 py-2 rounded flex items-center gap-1 ".concat(P?"opacity-50 cursor-not-allowed":"hover:bg-gray-500"),onClick:()=>{c(!1),u(e.name),x(e.email),S({})},children:[(0,t.jsx)(d.A,{size:16})," Cancel"]})]})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Name:"})," ",e.name]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Email:"})," ",e.email]}),(0,t.jsxs)("button",{className:"flex items-center gap-1 text-gray-500 hover:text-gray-700",onClick:()=>c(!0),children:[(0,t.jsx)(l.A,{size:16})," Edit"]})]})}),"password"===a&&(0,t.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block mb-1 font-medium",children:"Current Password"}),(0,t.jsx)("input",{type:"password",value:f,onChange:e=>w(e.target.value),className:"w-full border p-2 rounded"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block mb-1 font-medium",children:"New Password"}),(0,t.jsx)("input",{type:"password",value:j,onChange:e=>g(e.target.value),className:"w-full border p-2 rounded"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block mb-1 font-medium",children:"Confirm New Password"}),(0,t.jsx)("input",{type:"password",value:y,onChange:e=>N(e.target.value),className:"w-full border p-2 rounded"}),v.password&&(0,t.jsx)("p",{className:"text-red-500 text-sm",children:v.password})]}),(0,t.jsx)("button",{type:"submit",disabled:P,className:"bg-green-600 text-white px-4 py-2 rounded ".concat(P?"opacity-50 cursor-not-allowed":"hover:bg-green-700"),children:P?"Changing...":"Change Password"})]}),C&&(0,t.jsx)("p",{className:"mt-4 text-center text-sm text-gray-700 font-medium",children:C})]}):(0,t.jsx)("p",{className:"text-center mt-6",children:"Loading admin data..."})}},4515:(e,s,a)=>{Promise.resolve().then(a.bind(a,601))}},e=>{e.O(0,[96,76,358],()=>e(e.s=4515)),_N_E=e.O()}]);